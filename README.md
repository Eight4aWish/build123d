# build123d workspace

This workspace is set up to use the local virtual environment at `./.venv`.

## One-time setup

1. Create/activate the venv (if you don't already have one):

   ```sh
   # Prefer Homebrew Python 3.12 on macOS (recommended)
   /opt/homebrew/bin/python3.12 -m venv .venv
   source .venv/bin/activate
   python -m pip install -U pip
   ```

2. Install dependencies:

   ```sh
   python -m pip install -r requirements.txt
   ```

## Run the demo

```sh
./.venv/bin/python show_build123d_demo.py
```

## N8Synth faceplate (build123d rebuild)

Generate and view the faceplate (base + raised labels):

```sh
./.venv/bin/python n8synth_faceplate_build123d.py
```

Export separate STLs for 2-color printing:

```sh
./.venv/bin/python n8synth_faceplate_build123d.py --export-mode base   --stl n8_base.stl
./.venv/bin/python n8synth_faceplate_build123d.py --export-mode labels --stl n8_labels.stl
```

### Flush text (deboss / inlay)

The scripts support 3 text modes:

- `emboss` (default): raised text as a separate solid
- `deboss`: engraved text cut into the base (single-material friendly)
- `inlay`: engraved pocket in the base **plus** a matching “inlay” text solid for 2-color printing

For 2-layer inlay at 0.2 mm layer height:

```sh
./.venv/bin/python n8synth_faceplate_build123d.py --text-mode inlay --inlay-depth 0.4 --export-mode base   --stl-base n8_base_inlay.stl
./.venv/bin/python n8synth_faceplate_build123d.py --text-mode inlay --inlay-depth 0.4 --export-mode labels --stl-labels n8_inlay.stl
```

Notes for printing without an AMS (single extruder):

- A true flush 2-color inlay generally requires **both colors on the same layers** (near the top surface), so you may see multiple filament change prompts during those last 2 layers.
- Using a smaller nozzle (your 0.2 mm) and a modest inlay depth (0.4–0.6 mm) makes this far more reliable.
- If you want *easy* manual swapping with a single color-change, consider staying with `emboss` and setting `label_height` to 0.4–0.6 mm so only the very top layers print the text.

Print a 1:1 paper template (alignment check):

```sh
./.venv/bin/python n8synth_faceplate_build123d.py --template-svg n8_template.svg
```

Print the SVG at **100% / Actual Size** (disable “Fit to page”). A 10 mm calibration square is included to verify scale.

Optional label styles are configured in the `FaceplateParams` defaults in [n8synth_faceplate_build123d.py](n8synth_faceplate_build123d.py):

- Secondary (small italic) labels: `secondary_left` / `secondary_right`
- Inverse “output” labels (rounded rectangle plaque with the text knocked out):
   set `inverse_label_enable=True` and set `inverse_left` / `inverse_right` masks

## Daisy Patch Init faceplate (10HP, KiCad-import)

This faceplate is generated by importing hole and label placement from the KiCad panel file in `Daisy_Patch_Init/Frontpanel-DesignFiles/blank.kicad_pcb`, then applying the same build/export workflow as the N8Synth script (base + separate raised label solid for 2-color printing).

Generate and view (base + labels):

```sh
./.venv/bin/python daisy_patch_init_faceplate_build123d.py
```

Export separate STLs for 2-color printing:

```sh
./.venv/bin/python daisy_patch_init_faceplate_build123d.py --export-mode base   --stl patch_init_base.stl
./.venv/bin/python daisy_patch_init_faceplate_build123d.py --export-mode labels --stl patch_init_labels.stl
```

### Flush text (deboss / inlay)

```sh
./.venv/bin/python daisy_patch_init_faceplate_build123d.py --text-mode inlay --inlay-depth 0.4 --export-mode base   --stl-base patch_init_base_inlay.stl
./.venv/bin/python daisy_patch_init_faceplate_build123d.py --text-mode inlay --inlay-depth 0.4 --export-mode labels --stl-labels patch_init_inlay.stl
```

Tip: in `inlay`/`deboss` modes the “inverse label plaque” style is automatically disabled (it’s intended for raised plaque printing rather than inlay pockets).

Print a 1:1 paper template (alignment check):

```sh
./.venv/bin/python daisy_patch_init_faceplate_build123d.py --template-svg patch_init_template.svg
```

Optional tweaks:

- Scale imported KiCad font sizes: `--label-scale 1.2`
- Use scripted Eurorack mounting holes instead of the KiCad corner slots: `--use-script-mount-holes`

## VS Code viewer

Install the VS Code extension **OCP CAD Viewer** (`bernhard-42.ocp-cad-viewer`) and open it to view the model.

Key point: make sure you are running the scripts with the workspace venv at `./.venv`.
If you run them with a different interpreter (e.g. PlatformIO’s `penv`), you’ll typically get import errors or the viewer won’t receive anything.

If VS Code keeps prompting to switch interpreters, pick the workspace one:
`./.venv/bin/python` (this repo expects Python 3.12).

Recommended VS Code setup:

1. Select the interpreter: Command Palette → **Python: Select Interpreter** → choose `./.venv/bin/python`.
2. Open the viewer: Command Palette → **OCP CAD Viewer: Open Viewer** (or open the OCP CAD Viewer panel).
3. Run a script, e.g.:

   ```sh
   ./.venv/bin/python show_build123d_demo.py
   ```

Troubleshooting:

- If the script runs but the viewer stays empty, ensure the OCP CAD Viewer backend is running (you’ll usually see an “OCP backend” terminal).
- If you need to override host/port, copy `.env.example` to `.env` and set `OCP_VSCODE_HOST` / `OCP_VSCODE_PORT`.

## macOS “Not Opened” (possible malware) dialogs

On macOS, Gatekeeper can “quarantine” downloaded binaries. Many Python packages here include native extensions (`*.so` / `*.dylib`).
If you see repeated dialogs like:

- `orjson.cpython-312-darwin.so` Not Opened
- `vector.cpython-312-darwin.so` Not Opened
- `matrix44.cpython-312-darwin.so` Not Opened

…clear the quarantine flag for the venv’s `site-packages`:

```sh
cd /path/to/build123d
xattr -dr com.apple.quarantine .venv/lib/python*/site-packages
```

Or run the helper script:

```sh
./scripts/unquarantine_venv.sh
```
